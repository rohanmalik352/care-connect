<%- include('../partials/head') %>
<%- include('../partials/navbar') %>
<div class="container py-4">
  <%- include('../partials/flash') %>
  <h3 class="fw-bold mb-4"><i class="fas fa-user me-2 text-teal"></i>My Health Profile</h3>
  <div class="row g-4">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <form action="/patient/profile" method="POST">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Date of Birth</label>
                <input type="date" name="dob" class="form-control" value="<%= patient && patient.dob ? new Date(patient.dob).toISOString().split('T')[0] : '' %>" />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Gender</label>
                <select name="gender" class="form-select">
                  <option value="">Select</option>
                  <option value="Male" <%= patient && patient.gender === 'Male' ? 'selected' : '' %>>Male</option>
                  <option value="Female" <%= patient && patient.gender === 'Female' ? 'selected' : '' %>>Female</option>
                  <option value="Other" <%= patient && patient.gender === 'Other' ? 'selected' : '' %>>Other</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Blood Group</label>
                <select name="bloodGroup" class="form-select">
                  <option value="">Select</option>
                  <% ['A+','A-','B+','B-','O+','O-','AB+','AB-'].forEach(bg => { %>
                    <option value="<%= bg %>" <%= patient && patient.bloodGroup === bg ? 'selected' : '' %>><%= bg %></option>
                  <% }) %>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Phone Number</label>
                <input type="text" name="phone" class="form-control" value="<%= patient && patient.phone || '' %>" />
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold">Address</label>
                <textarea name="address" class="form-control" rows="2"><%= patient && patient.address || '' %></textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Allergies <small class="text-muted">(comma separated)</small></label>
                <input type="text" name="allergies" class="form-control" value="<%= patient && patient.allergies ? patient.allergies.join(', ') : '' %>" placeholder="Penicillin, Dust, Pollen" />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Chronic Conditions <small class="text-muted">(comma separated)</small></label>
                <input type="text" name="chronicConditions" class="form-control" value="<%= patient && patient.chronicConditions ? patient.chronicConditions.join(', ') : '' %>" placeholder="Diabetes, Hypertension" />
              </div>
            </div>
            <button type="submit" class="btn btn-teal mt-4 px-5">
              <i class="fas fa-save me-2"></i>Save Profile
            </button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center p-4">
          <div class="avatar-circle mx-auto mb-3"><%= user.name.charAt(0).toUpperCase() %></div>
          <h5 class="fw-bold"><%= user.name %></h5>
          <p class="text-muted"><%= user.email %></p>
          <span class="badge bg-teal px-3 py-2">Patient</span>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include('../partials/footer') %>
