<%- include('../partials/head') %>
<%- include('../partials/navbar') %>
<div class="container py-4">
  <%- include('../partials/flash') %>
  <h3 class="fw-bold mb-4"><i class="fas fa-file-medical me-2 text-teal"></i>My Medical Records</h3>

  <% if (records.length === 0) { %>
    <div class="text-center py-5 text-muted">
      <i class="fas fa-folder-open fa-4x mb-3 opacity-25"></i>
      <p class="fs-5">No medical records found.</p>
      <p class="small">Your records will appear here after doctor consultations.</p>
    </div>
  <% } else { %>
    <div class="row g-3">
      <% records.forEach(r => { %>
        <div class="col-12">
          <div class="card border-0 shadow-sm record-card">
            <div class="card-body d-flex flex-wrap align-items-center gap-3">
              <div class="record-date text-center">
                <div class="fw-bold fs-5"><%= new Date(r.visitDate).getDate() %></div>
                <div class="text-muted small"><%= new Date(r.visitDate).toLocaleString('default', {month:'short'}) %> <%= new Date(r.visitDate).getFullYear() %></div>
              </div>
              <div class="flex-grow-1">
                <div class="d-flex align-items-center gap-2 mb-1">
                  <span class="badge bg-teal"><%= r.visitType %></span>
                  <% if (r.isEmergency) { %><span class="badge bg-danger">Emergency</span><% } %>
                </div>
                <h6 class="fw-bold mb-1"><%= r.chiefComplaint || 'Consultation' %></h6>
                <p class="text-muted small mb-0">
                  Dr. <%= r.doctor?.user?.name || 'Unknown' %>
                  <% if (r.hospital) { %> &bull; <%= r.hospital %><% } %>
                </p>
                <% if (r.diagnosis && r.diagnosis.length > 0) { %>
                  <div class="mt-1">
                    <% r.diagnosis.forEach(d => { %><span class="badge bg-light text-dark border me-1"><%= d %></span><% }) %>
                  </div>
                <% } %>
              </div>
              <a href="/patient/records/<%= r._id %>" class="btn btn-outline-teal btn-sm">
                <i class="fas fa-eye me-1"></i>View
              </a>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>
<%- include('../partials/footer') %>
