<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CareConnect ‚Äì Patient Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Sora:wght@600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/styles.css"/>
  <style>
    .modal-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.35); backdrop-filter: blur(3px);
      z-index: 100; align-items: center; justify-content: center;
    }
    .modal-overlay.open { display: flex; }
    .modal-box {
      background: white; border-radius: 1.5rem;
      padding: 2rem; width: 90%; max-width: 440px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      animation: popIn .2s ease;
    }
    @keyframes popIn { from{transform:scale(.92);opacity:0} to{transform:scale(1);opacity:1} }

    .section-panel { display: none; }
    .section-panel.active { display: block; }

    #toast {
      position: fixed; bottom: 2rem; right: 2rem;
      background: #1f2937; color: white;
      padding: .75rem 1.25rem; border-radius: 1rem;
      font-size: .875rem; font-weight: 500;
      transform: translateY(80px); opacity: 0;
      transition: all .3s; z-index: 200;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    #toast.show { transform: translateY(0); opacity: 1; }

    .med-taken {
      opacity: .5;
      text-decoration: line-through;
      pointer-events: none;
    }
    .chart-tab { padding:.4rem .875rem; border-radius:.75rem; font-size:.8rem; font-weight:500; cursor:pointer; border:1.5px solid #e5e7eb; background:white; color:#6b7280; transition:all .2s; }
    .chart-tab.active { background:var(--purple-light); color:var(--purple); border-color:var(--purple-lighter); font-weight:600; }

    input[type="text"], input[type="date"], textarea, select {
      font-family: 'DM Sans', sans-serif;
      border: 1.5px solid #e5e7eb; border-radius: .875rem;
      padding: .6rem .9rem; font-size: .875rem; outline: none;
      transition: border .2s; width: 100%;
    }
    input:focus, textarea:focus { border-color: #7c5cfc; }
  </style>
</head>
<body class="page-patient flex h-screen overflow-hidden" style="background:var(--bg-patient)">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODALS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- Learn More Modal -->
<div class="modal-overlay" id="modalLearnMore">
  <div class="modal-box">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-display font-bold text-lg text-gray-800" id="learnMoreTitle"></h3>
      <button onclick="closeModal('modalLearnMore')" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 hover:bg-red-50 hover:text-red-500 transition-colors">‚úï</button>
    </div>
    <div id="learnMoreBody" class="text-sm text-gray-600 leading-relaxed space-y-3"></div>
    <button class="btn-purple w-full mt-5" onclick="closeModal('modalLearnMore')">Got it</button>
  </div>
</div>

<!-- Track Progress Modal -->
<div class="modal-overlay" id="modalTrack">
  <div class="modal-box">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-display font-bold text-lg text-gray-800">Track Progress</h3>
      <button onclick="closeModal('modalTrack')" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 hover:bg-red-50 hover:text-red-500 transition-colors">‚úï</button>
    </div>
    <div class="space-y-3 mb-4">
      <div><label class="text-xs font-semibold text-gray-500 block mb-1">Today's reading</label>
        <input type="text" id="trackValue" placeholder="e.g. 126/80 or 138 mg/dL"/>
      </div>
      <div><label class="text-xs font-semibold text-gray-500 block mb-1">Notes</label>
        <textarea id="trackNote" rows="2" placeholder="How are you feeling?" style="resize:none"></textarea>
      </div>
    </div>
    <div class="flex gap-3">
      <button class="btn-purple flex-1" onclick="saveProgress()">Save Reading</button>
      <button onclick="closeModal('modalTrack')" style="flex:1;padding:.65rem;border-radius:.875rem;border:1.5px solid #e5e7eb;background:white;cursor:pointer;font-weight:600;color:#6b7280">Cancel</button>
    </div>
  </div>
</div>

<!-- SOS Modal -->
<div class="modal-overlay" id="modalSOS">
  <div class="modal-box" style="text-align:center">
    <div style="font-size:3rem;margin-bottom:.5rem">üö®</div>
    <h3 class="font-display font-bold text-xl text-red-600 mb-2">Emergency SOS</h3>
    <p class="text-sm text-gray-500 mb-5">This will alert your care team and emergency services. Your location will be shared. Are you sure?</p>
    <div class="flex gap-3">
      <button class="w-full py-3 rounded-2xl font-bold text-white text-sm" style="background:linear-gradient(135deg,#ef4444,#dc2626);border:none;cursor:pointer;box-shadow:0 4px 12px rgba(239,68,68,.4)" onclick="confirmSOS()">
        üö® YES ‚Äî Send Alert Now
      </button>
      <button onclick="closeModal('modalSOS')" style="flex:1;padding:.75rem;border-radius:1rem;border:1.5px solid #e5e7eb;background:white;cursor:pointer;font-weight:600;color:#6b7280;font-family:inherit">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Book Appointment Modal -->
<div class="modal-overlay" id="modalBookAppt">
  <div class="modal-box">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-display font-bold text-lg text-gray-800">Book Appointment</h3>
      <button onclick="closeModal('modalBookAppt')" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 hover:bg-red-50 hover:text-red-500 transition-colors">‚úï</button>
    </div>
    <div class="space-y-3">
      <select>
        <option>Select Doctor</option>
        <option>Dr. Chen ‚Äì Cardiologist</option>
        <option>Dr. Smith ‚Äì Neurologist</option>
        <option>Dr. Patel ‚Äì General</option>
      </select>
      <input type="date" id="apptDate"/>
      <select>
        <option>Select Time</option>
        <option>09:00 AM</option><option>11:00 AM</option>
        <option>02:00 PM</option><option>04:00 PM</option>
      </select>
      <textarea rows="2" placeholder="Describe your symptoms‚Ä¶" style="resize:none"></textarea>
    </div>
    <div class="flex gap-3 mt-4">
      <button class="btn-purple flex-1" onclick="bookAppt()">Confirm Booking</button>
      <button onclick="closeModal('modalBookAppt')" style="flex:1;padding:.65rem;border-radius:.875rem;border:1.5px solid #e5e7eb;background:white;cursor:pointer;font-weight:600;color:#6b7280">Cancel</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SIDEBAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<aside class="sidebar w-60 flex-shrink-0 flex flex-col p-4 overflow-y-auto scroll-thin">
  <div class="flex items-center gap-2 mb-8 px-2">
    <div class="logo-icon" style="width:32px;height:32px;border-radius:9px;background:linear-gradient(135deg,#7c5cfc,#3ecf8e)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
    </div>
    <span class="font-display font-bold text-gray-800 text-lg">CareConnect</span>
  </div>

  <div class="mb-2 px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">My Health</div>
  <nav class="space-y-1 mb-6">
    <div class="nav-item active" data-section="dashboard" onclick="switchSection(this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg> Dashboard
    </div>
    <div class="nav-item" data-section="records" onclick="switchSection(this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg> My Records
    </div>
    <div class="nav-item" data-section="prescriptions" onclick="switchSection(this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm1 14H8v-2h5v2zm3-4H8v-2h8v2zm0-4H8V7h8v2z"/></svg> Prescriptions
      <span class="ml-auto w-5 h-5 rounded-full flex items-center justify-center text-white font-bold" style="font-size:.65rem;background:var(--purple)" id="rxBadge">3</span>
    </div>
    <div class="nav-item" data-section="appointments" onclick="switchSection(this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg> Appointments
    </div>
    <div class="nav-item" data-section="messages" onclick="switchSection(this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg> Messages
    </div>
  </nav>

  <div class="mt-auto">
    <div class="neo p-3 flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold text-sm" style="background:linear-gradient(135deg,#7c5cfc,#5b3fd4)">AM</div>
      <div>
        <div class="text-sm font-semibold text-gray-800">Alice Morgan</div>
        <div class="text-xs text-gray-400">Patient ID: B-345</div>
      </div>
    </div>
    <a href="/" class="block text-center text-xs text-gray-400 mt-3 hover:text-red-500 transition-colors">Sign Out</a>
  </div>
</aside>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MAIN CONTENT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<main class="flex-1 overflow-y-auto scroll-thin p-6">

  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="font-display text-2xl font-bold text-gray-800">Hello, <span style="color:var(--purple)">Alice</span> üëã</h1>
      <p class="text-gray-400 text-sm mt-0.5">Monday, February 23, 2026 ¬∑ Next check-up in <span class="font-medium" style="color:var(--purple)">5 days</span></p>
    </div>
    <div class="flex items-center gap-3">
      <div class="neo rounded-2xl px-4 py-2 flex items-center gap-2 text-sm text-gray-700">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="#7c5cfc"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
        Health Score: <strong style="color:var(--purple)" id="healthScore">78/100</strong>
      </div>
      <button class="btn-purple" onclick="openModal('modalBookAppt')">+ Book Appointment</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ DASHBOARD SECTION ‚îÄ‚îÄ -->
  <div class="section-panel active" id="section-dashboard">

    <!-- Diagnoses -->
    <div class="neo p-5 mb-6">
      <div class="font-display font-bold text-gray-800 mb-4">My Diagnoses</div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% diagnoses.forEach((d,i) => { %>
        <div class="rounded-2xl p-5 border border-gray-100 bg-gray-50 hover:bg-purple-50 hover:border-purple-100 transition-all">
          <div class="flex items-center justify-between mb-2">
            <span class="font-semibold text-gray-800"><%= d.condition %></span>
            <span class="badge severity-<%= d.severity.toLowerCase() %>" style="border-radius:9999px;padding:.2rem .75rem;font-size:.72rem;font-weight:700"><%= d.severity %></span>
          </div>
          <p class="text-sm text-gray-500 leading-relaxed"><%= d.desc %></p>
          <div class="flex gap-2 mt-3">
            <button class="btn-purple" style="padding:.4rem .875rem;font-size:.78rem"
              onclick="learnMore('<%= d.condition %>', '<%= d.severity %>')">Learn More</button>
            <button class="btn-green" style="padding:.4rem .875rem;font-size:.78rem"
              onclick="openModal('modalTrack')">Track Progress</button>
          </div>
        </div>
        <% }) %>
      </div>
    </div>

    <!-- Health Charts -->
    <div class="neo p-5 mb-6">
      <div class="flex items-center justify-between mb-4 flex-wrap gap-3">
        <div class="font-display font-bold text-gray-800">Health Tracker</div>
        <div class="flex gap-2">
          <button class="chart-tab active" id="tab-bp"    onclick="switchChart('bp'   )">Blood Pressure</button>
          <button class="chart-tab"        id="tab-sugar" onclick="switchChart('sugar')">Blood Sugar</button>
          <button class="chart-tab"        id="tab-hr"    onclick="switchChart('hr'   )">Heart Rate</button>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div class="col-span-1 md:col-span-3">
          <canvas id="mainHealthChart" height="120"></canvas>
        </div>
        <div class="flex flex-col gap-2 justify-center">
          <div id="chartStatCard" class="rounded-2xl p-4 text-center" style="background:var(--purple-light)">
            <div class="font-display text-2xl font-bold" style="color:var(--purple)" id="chartStatVal">128/82</div>
            <div class="text-xs text-gray-500 mt-1" id="chartStatLabel">mmHg</div>
            <div class="text-xs font-semibold mt-2" id="chartStatStatus">Elevated</div>
          </div>
          <button class="btn-purple w-full" style="font-size:.8rem;padding:.5rem" onclick="openModal('modalTrack')">Log Reading</button>
        </div>
      </div>
    </div>

    <!-- Medicines + Upload -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

      <!-- Medicine Reminders -->
      <div class="neo p-5">
        <div class="flex items-center justify-between mb-4">
          <div class="font-display font-bold text-gray-800">üíä Medicine Reminders</div>
          <span class="text-xs text-gray-400" id="medProgress">0 / <%= medicines.length %> taken today</span>
        </div>
        <div class="space-y-3" id="medList">
          <% medicines.forEach((m, i) => {
            const gradients = ['#7c5cfc,#5b3fd4','#3ecf8e,#26a96c','#f59e0b,#d97706'];
          %>
          <div class="med-pill flex items-center justify-between" id="med-<%= i %>">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:linear-gradient(135deg,<%= gradients[i] %>)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M4.22 11.29l7.07-7.07a5.01 5.01 0 017.07 0 5.01 5.01 0 010 7.07l-7.07 7.07a5.01 5.01 0 01-7.07 0 5.01 5.01 0 010-7.07zm1.42 5.66c1.17 1.17 3.07 1.17 4.24 0l3.54-3.54-4.24-4.24-3.54 3.54c-1.17 1.17-1.17 3.07 0 4.24z"/></svg>
              </div>
              <div>
                <div class="text-sm font-semibold text-gray-800"><%= m.name %></div>
                <div class="text-xs text-gray-500"><%= m.time %> ¬∑ <%= m.food %></div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-xs font-semibold" style="color:<%= m.refill.includes('5') ? '#dc2626' : '#7c5cfc' %>"><%= m.refill %></div>
              <button class="btn-purple mt-1" id="medbtn-<%= i %>" style="padding:.25rem .65rem;font-size:.72rem"
                onclick="markTaken(<%= i %>)">Mark Taken</button>
            </div>
          </div>
          <% }) %>
        </div>
      </div>

      <!-- Medical Records Upload -->
      <div class="neo p-5">
        <div class="font-display font-bold text-gray-800 mb-4">üìÅ Medical Records</div>
        <div class="upload-zone mb-4" id="uploadZone"
             ondragover="event.preventDefault();this.style.borderColor='#7c5cfc'"
             ondragleave="this.style.borderColor=''"
             ondrop="handleDrop(event)">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="#c4b5fd" class="mx-auto mb-2">
            <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
          </svg>
          <div class="text-sm font-medium text-purple-700">Drop files here or click to upload</div>
          <div class="text-xs text-gray-400 mt-1">PDF, JPG, PNG up to 10MB</div>
          <input type="file" id="fileInput" class="hidden" onchange="handleFileSelect(this)"/>
        </div>
        <div class="space-y-2 mb-4" id="fileList">
          <% ['Blood Test Report ‚Äì Jan 2026.pdf','ECG Scan ‚Äì Dec 2025.pdf','Prescription ‚Äì Feb 2026.pdf'].forEach(f => { %>
          <div class="flex items-center justify-between bg-gray-50 rounded-xl px-3 py-2">
            <div class="flex items-center gap-2">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#7c5cfc"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 9.5h1v1H9v-1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>
              <span class="text-xs text-gray-700"><%= f %></span>
            </div>
            <button class="text-xs font-semibold hover:underline" style="color:var(--purple);background:none;border:none;cursor:pointer" onclick="toast('üìÑ Opening file...','#7c5cfc')">View</button>
          </div>
          <% }) %>
        </div>
        <div class="flex gap-3">
          <button class="btn-purple flex-1" onclick="document.getElementById('fileInput').click()">Upload Lab Report</button>
          <button class="btn-green flex-1"  onclick="document.getElementById('fileInput').click()">Upload Scan</button>
        </div>
      </div>
    </div>

    <!-- Emergency SOS -->
    <div class="neo p-6 flex flex-col items-center text-center">
      <div class="font-display font-bold text-gray-800 mb-1">Emergency Assistance</div>
      <p class="text-sm text-gray-400 mb-5">Press for immediate emergency response. Your location will be shared with your care team.</p>
      <button class="sos-btn w-28 h-28 rounded-full text-white font-display font-bold text-sm flex flex-col items-center justify-center gap-1"
              onclick="openModal('modalSOS')">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
        <span>EMERGENCY</span><span>SOS</span>
      </button>
      <p class="text-xs text-gray-300 mt-4">Dr. Chen ¬∑ Emergency: 108 ¬∑ Ambulance ready</p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ RECORDS SECTION ‚îÄ‚îÄ -->
  <div class="section-panel" id="section-records">
    <div class="neo p-6">
      <h2 class="font-display font-bold text-xl text-gray-800 mb-5">My Health Records</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% [
          {title:'Blood Test ‚Äì Jan 2026', date:'Jan 15, 2026', status:'Normal', icon:'ü©∏'},
          {title:'ECG Scan ‚Äì Dec 2025',  date:'Dec 8, 2025',  status:'Review needed', icon:'‚ù§Ô∏è'},
          {title:'X-Ray ‚Äì Nov 2025',     date:'Nov 22, 2025', status:'Normal', icon:'ü¶¥'},
          {title:'MRI Brain ‚Äì Oct 2025', date:'Oct 5, 2025',  status:'Normal', icon:'üß†'},
        ].forEach(r => { %>
        <div class="flex items-center justify-between p-4 rounded-xl border border-gray-100 bg-white hover:bg-purple-50 hover:border-purple-100 transition-all cursor-pointer"
             onclick="toast('üìÑ Opening record...', '#7c5cfc')">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl" style="background:var(--purple-light)"><%= r.icon %></div>
            <div>
              <div class="font-semibold text-gray-800 text-sm"><%= r.title %></div>
              <div class="text-xs text-gray-400"><%= r.date %></div>
            </div>
          </div>
          <div class="text-right">
            <span class="badge <%= r.status==='Normal' ? 'badge-low' : 'badge-med' %>"><%= r.status %></span>
            <div class="mt-2"><button class="btn-purple" style="padding:.3rem .7rem;font-size:.75rem" onclick="event.stopPropagation();toast('üì• Downloading...','#7c5cfc')">Download</button></div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ PRESCRIPTIONS SECTION ‚îÄ‚îÄ -->
  <div class="section-panel" id="section-prescriptions">
    <div class="neo p-6">
      <h2 class="font-display font-bold text-xl text-gray-800 mb-5">My Prescriptions</h2>
      <div class="space-y-4" id="rxList"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ APPOINTMENTS SECTION ‚îÄ‚îÄ -->
  <div class="section-panel" id="section-appointments">
    <div class="neo p-6">
      <div class="flex items-center justify-between mb-5">
        <h2 class="font-display font-bold text-xl text-gray-800">My Appointments</h2>
        <button class="btn-purple" onclick="openModal('modalBookAppt')">+ Book New</button>
      </div>
      <div class="space-y-3">
        <% [
          {date:'Feb 28, 2026', time:'10:00 AM', doctor:'Dr. Chen', type:'Cardiology Follow-up', status:'Confirmed'},
          {date:'Mar 5, 2026',  time:'02:30 PM', doctor:'Dr. Smith', type:'Neurology Check',   status:'Pending'},
          {date:'Mar 12, 2026', time:'09:00 AM', doctor:'Dr. Patel', type:'General Checkup',   status:'Confirmed'},
        ].forEach(a => { %>
        <div class="flex items-center justify-between p-4 rounded-xl border border-gray-100 bg-white hover:bg-purple-50 hover:border-purple-100 transition-all">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-xs text-center leading-tight" style="background:linear-gradient(135deg,#7c5cfc,#5b3fd4)">
              <%= a.date.split(' ')[1].replace(',','') %><br><span style="font-size:.65rem;font-weight:400"><%= a.date.split(' ')[0] %></span>
            </div>
            <div>
              <div class="font-semibold text-gray-800 text-sm"><%= a.type %></div>
              <div class="text-xs text-gray-400"><%= a.doctor %> ¬∑ <%= a.time %></div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="badge <%= a.status==='Confirmed'?'badge-confirmed':'badge-pending' %>"><%= a.status %></span>
            <button class="btn-purple" style="padding:.35rem .75rem;font-size:.75rem" onclick="toast('üìÖ Opening appointment details...','#7c5cfc')">Details</button>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ MESSAGES SECTION ‚îÄ‚îÄ -->
  <div class="section-panel" id="section-messages">
    <div class="neo p-6">
      <h2 class="font-display font-bold text-xl text-gray-800 mb-5">Messages from Care Team</h2>
      <div class="space-y-3" id="patMsgList"></div>
    </div>
  </div>

</main>

<!-- Toast -->
<div id="toast"></div>

<script>
const medicines = <%- JSON.stringify(medicines) %>;
let medTaken = 0;

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toast(msg, color='#1f2937') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.style.background = color;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ‚îÄ‚îÄ Modal helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(id)  { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m =>
  m.addEventListener('click', e => { if(e.target===m) m.classList.remove('open'); })
);

// ‚îÄ‚îÄ Section switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchSection(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.section-panel').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
  const sec = el.dataset.section;
  document.getElementById('section-'+sec).classList.add('active');
  if(sec==='prescriptions') renderPrescriptions();
  if(sec==='messages')      renderMessages();
}

// ‚îÄ‚îÄ Medicine ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function markTaken(i) {
  const row = document.getElementById('med-'+i);
  const btn = document.getElementById('medbtn-'+i);
  row.classList.add('med-taken');
  btn.textContent = '‚úì Taken';
  btn.style.background = 'linear-gradient(135deg,#3ecf8e,#26a96c)';
  medTaken++;
  document.getElementById('medProgress').textContent = `${medTaken} / ${medicines.length} taken today`;
  if(medTaken === medicines.length) toast('üéâ All medicines taken for today!', '#3ecf8e');
  else toast(`‚úÖ ${medicines[i].name} marked as taken`, '#3ecf8e');
}

// ‚îÄ‚îÄ Health Charts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const chartData = {
  bp:    { data:[122,130,125,135,128,132,128], color:'#ef4444', unit:'mmHg', val:'128/82', status:'Elevated' },
  sugar: { data:[155,140,162,148,138,150,142], color:'#f59e0b', unit:'mg/dL', val:'142',   status:'Moderate' },
  hr:    { data:[68, 74, 71, 76, 70, 73, 72],  color:'#3ecf8e', unit:'bpm',   val:'72',    status:'Normal'   },
};
const labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Today'];
let mainChart = null;
let currentChartKey = 'bp';

function buildChart(key) {
  const ctx = document.getElementById('mainHealthChart').getContext('2d');
  if(mainChart) mainChart.destroy();
  const d = chartData[key];
  mainChart = new Chart(ctx, {
    type:'line',
    data:{labels, datasets:[{
      data: d.data, borderColor: d.color,
      backgroundColor: d.color.replace(')',', .1)').replace('rgb','rgba'),
      borderWidth:2.5, tension:0.4, fill:true,
      pointBackgroundColor: d.color, pointRadius:5, pointHoverRadius:7
    }]},
    options:{
      responsive:true,
      plugins:{
        legend:{display:false},
        tooltip:{callbacks:{label:c=>`${c.parsed.y} ${d.unit}`}}
      },
      scales:{
        y:{grid:{color:'#f3f4f6'},ticks:{font:{size:10}}},
        x:{grid:{display:false},ticks:{font:{size:10}}}
      }
    }
  });
  // Update stat card
  document.getElementById('chartStatVal').textContent  = d.val;
  document.getElementById('chartStatLabel').textContent= d.unit;
  document.getElementById('chartStatStatus').textContent=d.status;
  document.getElementById('chartStatStatus').style.color = d.color;
}

function switchChart(key) {
  currentChartKey = key;
  ['bp','sugar','hr'].forEach(k => {
    document.getElementById('tab-'+k).classList.toggle('active', k===key);
  });
  buildChart(key);
}

// ‚îÄ‚îÄ Learn More ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const learnMoreInfo = {
  'Type 2 Diabetes': {
    info: [
      'ü©∏ Your body has difficulty using insulin properly, causing blood sugar to stay elevated.',
      'ü•ó Recommended: Low-carb diet, regular 30-min walks, reduce sugary drinks.',
      'üíä Metformin helps your body use insulin better ‚Äî take it consistently with meals.',
      'üìä Target blood sugar: 80‚Äì130 mg/dL before meals, below 180 mg/dL after meals.'
    ]
  },
  'Hypertension': {
    info: [
      '‚ù§Ô∏è Your blood pressure is regularly above 130/80 mmHg, putting strain on your heart.',
      'üßÇ Reduce sodium intake ‚Äî aim for less than 1,500mg per day.',
      'üèÉ Exercise helps: aim for 150 minutes of moderate activity per week.',
      'üéØ Target: Keep readings below 130/80 mmHg consistently.'
    ]
  }
};
function learnMore(condition, severity) {
  document.getElementById('learnMoreTitle').textContent = condition;
  const info = learnMoreInfo[condition];
  if(info) {
    document.getElementById('learnMoreBody').innerHTML = info.info.map(i =>
      `<div class="p-3 rounded-xl bg-purple-50 text-gray-700">${i}</div>`
    ).join('');
  }
  openModal('modalLearnMore');
}

// ‚îÄ‚îÄ Track Progress ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveProgress() {
  const val = document.getElementById('trackValue').value.trim();
  if(!val) { toast('‚ö†Ô∏è Please enter a reading', '#f59e0b'); return; }
  closeModal('modalTrack');
  toast('üìà Reading saved successfully!', '#3ecf8e');
  document.getElementById('trackValue').value='';
  document.getElementById('trackNote').value='';
}

// ‚îÄ‚îÄ SOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function confirmSOS() {
  closeModal('modalSOS');
  toast('üö® Emergency alert sent! Help is on the way.', '#dc2626');
}

// ‚îÄ‚îÄ Book Appointment ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function bookAppt() {
  closeModal('modalBookAppt');
  toast('‚úÖ Appointment request sent!', '#7c5cfc');
}

// ‚îÄ‚îÄ File Upload ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('uploadZone').addEventListener('click', () => {
  document.getElementById('fileInput').click();
});
function handleFileSelect(input) {
  if(input.files.length > 0) addFile(input.files[0].name);
}
function handleDrop(e) {
  e.preventDefault();
  document.getElementById('uploadZone').style.borderColor='';
  if(e.dataTransfer.files.length > 0) addFile(e.dataTransfer.files[0].name);
}
function addFile(name) {
  const list = document.getElementById('fileList');
  const row = document.createElement('div');
  row.className = 'flex items-center justify-between bg-green-50 rounded-xl px-3 py-2';
  row.innerHTML = `<div class="flex items-center gap-2">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="#3ecf8e"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 9.5h1v1H9v-1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>
    <span class="text-xs text-gray-700">${name}</span>
  </div>
  <button class="text-xs font-semibold hover:underline" style="color:var(--green-dark);background:none;border:none;cursor:pointer">‚úì Uploaded</button>`;
  list.appendChild(row);
  toast(`üì§ ${name} uploaded!`, '#3ecf8e');
}

// ‚îÄ‚îÄ Prescriptions section 
function renderPrescriptions() {
  document.getElementById('rxList').innerHTML = medicines.map((m,i) => {
    const gradients=['#7c5cfc,#5b3fd4','#3ecf8e,#26a96c','#f59e0b,#d97706'];
    return `<div class="p-4 rounded-2xl border border-purple-100 bg-purple-50 hover:bg-purple-100 transition-all">
      <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background:linear-gradient(135deg,${gradients[i]})">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M4.22 11.29l7.07-7.07a5.01 5.01 0 017.07 0 5.01 5.01 0 010 7.07l-7.07 7.07a5.01 5.01 0 01-7.07 0 5.01 5.01 0 010-7.07z"/></svg>
          </div>
          <div>
            <div class="font-semibold text-gray-800">${m.name}</div>
            <div class="text-xs text-gray-500">${m.time} ¬∑ ${m.food}</div>
          </div>
        </div>
        <span class="badge" style="background:white;border:1px solid #e9d5ff;color:#7c5cfc">${m.refill}</span>
      </div>
      <div class="flex gap-2 mt-3">
        <button class="btn-purple flex-1" style="font-size:.8rem;padding:.45rem" onclick="toast('üìã Prescription details...','#7c5cfc')">View Details</button>
        <button class="btn-green flex-1"  style="font-size:.8rem;padding:.45rem" onclick="toast('üîÑ Refill request sent!','#3ecf8e')">Request Refill</button>
      </div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ Messages section
const patMessages = [
  {from:'Dr. Chen',    msg:'Your latest blood work shows improvement. Keep up with the medication schedule.', time:'Today 9AM',   unread:true},
  {from:'Nurse Priya', msg:'Reminder: Please fast for 8 hours before your blood test on Feb 28.',              time:'Yesterday',   unread:true},
  {from:'Dr. Chen',    msg:'I\'ve updated your Amlodipine dosage. Please review the new prescription.',        time:'Feb 20',      unread:false},
];
function renderMessages() {
  document.getElementById('patMsgList').innerHTML = patMessages.map((m,i) =>
    `<div class="p-4 rounded-xl border ${m.unread?'border-purple-100 bg-purple-50':'border-gray-100 bg-white'} hover:bg-purple-50 transition-all cursor-pointer"
          onclick="readPatMsg(${i})">
      <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-xs" style="background:linear-gradient(135deg,#7c5cfc,#5b3fd4)">
            ${m.from.split(' ').map(n=>n[0]).join('')}
          </div>
          <span class="font-semibold text-gray-800 text-sm">${m.from}</span>
          ${m.unread?'<span class="w-2 h-2 rounded-full bg-purple-500 inline-block"></span>':''}
        </div>
        <span class="text-xs text-gray-400">${m.time}</span>
      </div>
      <p class="text-sm text-gray-500 ml-10">${m.msg}</p>
    </div>`
  ).join('');
}
function readPatMsg(i) {
  patMessages[i].unread = false;
  renderMessages();
  toast('üì© Message opened', '#7c5cfc');
}

// ‚îÄ‚îÄ Init 
buildChart('bp');
</script>
</body>
</html>
