<%- include('../partials/head') %>
<%- include('../partials/navbar') %>
<div class="dashboard-wrapper">
  <aside class="sidebar">
    <div class="sidebar-logo"><i class="fas fa-heartbeat green me-2"></i>Care<span class="green">Connect</span></div>
    <a href="/doctor/dashboard" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-th-large"></i></span><span>Dashboard</span></a>
    <a href="/doctor/search-patient" class="sidebar-link active"><span class="sidebar-icon"><i class="fas fa-users"></i></span><span>Patient List</span></a>
    <a href="/doctor/forum" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-comments"></i></span><span>Collaboration</span></a>
    <a href="/doctor/profile" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-user-md"></i></span><span>My Profile</span></a>
    <a href="/auth/logout" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-sign-out-alt"></i></span><span>Logout</span></a>
  </aside>
  <main class="dashboard-content">
    <%- include('../partials/flash') %>
    <div class="dash-topbar">
      <div>
        <h4 class="fw-800 mb-0">Patient List</h4>
        <p class="text-muted small mb-0">Search and manage your patients</p>
      </div>
    </div>

    <!-- Search -->
    <div class="cc-card mb-4 p-4">
      <form action="/doctor/search-patient" method="GET">
        <div class="d-flex gap-3">
          <div class="search-bar flex-grow-1" style="width:auto;border-radius:14px">
            <i class="fas fa-search"></i>
            <input type="text" name="q" value="<%= q || '' %>" placeholder="Search by patient name or ABHA ID..." style="font-size:0.95rem" />
          </div>
          <button type="submit" class="btn btn-purple px-4">Search</button>
        </div>
      </form>
    </div>

    <% if (typeof q !== 'undefined' && q) { %>
      <h6 class="fw-700 mb-3 text-muted">Results for "<%= q %>" â€” <%= patients.length %> found</h6>
      <% if (patients.length === 0) { %>
        <div class="cc-card p-5 text-center">
          <i class="fas fa-user-slash fa-4x mb-3 opacity-25"></i>
          <p class="text-muted">No patients found for "<%= q %>"</p>
        </div>
      <% } else { %>
        <div class="patient-grid">
          <% patients.forEach((p,i) => { %>
            <a href="/doctor/patient/<%= p._id %>" class="patient-card">
              <div class="p-avatar <%= ['pav-green','pav-purple','pav-blue','pav-red'][i%4] %>">
                <%= p.user?.name?.charAt(0).toUpperCase() || '?' %>
              </div>
              <div class="fw-700 mb-1"><%= p.user?.name %></div>
              <div class="text-muted small mb-2"><%= p.user?.email %></div>
              <% if (p.abhaId) { %><span class="badge-green mb-1 d-block" style="font-size:0.65rem">ABHA: <%= p.abhaId %></span><% } %>
              <div class="d-flex justify-content-center gap-2 mt-2">
                <% if(p.bloodGroup) { %><span class="badge-purple"><%= p.bloodGroup %></span><% } %>
                <% if(p.gender) { %><span class="badge-green"><%= p.gender %></span><% } %>
              </div>
            </a>
          <% }) %>
        </div>
      <% } %>
    <% } else { %>
      <div class="cc-card p-5 text-center">
        <i class="fas fa-search fa-4x mb-3" style="color:var(--purple-mid);opacity:0.3"></i>
        <p class="fw-600 mb-1">Search for a Patient</p>
        <p class="text-muted small">Enter a name or ABHA ID above to find patient records</p>
      </div>
    <% } %>
  </main>
</div>
<%- include('../partials/footer') %>
